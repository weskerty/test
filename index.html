<script>
    async function loadContent(url, updateHistory = true) {
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`Error fetching ${url}: ${response.statusText}`);
            const htmlContent = await response.text();
            document.getElementById('content').innerHTML = htmlContent;

            // Actualiza la URL en la barra de direcciones sin recargar la página
            if (updateHistory) {
                history.pushState({ url: url }, '', url);
            }

            // Cargar Disqus en la nueva sección
            const disqusDiv = document.createElement('div');
            disqusDiv.id = 'disqus_thread';
            document.getElementById('content').appendChild(disqusDiv);

            var disqus_config = function () {
                this.page.url = window.location.href; 
                this.page.identifier = document.title;
            };

            (function() {  
                var d = document, s = d.createElement('script');
                s.src = 'https://amigos-steam.disqus.com/embed.js'; 
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        } catch (error) {
            console.error(error);
            document.getElementById('content').innerHTML = `<p>Error loading content: ${error.message}</p>`;
        }
    }

    // Manejador de eventos para los enlaces internos
    document.addEventListener('click', function(event) {
        const target = event.target;

        // Si el elemento clicado es un enlace
        if (target.tagName === 'A') {
            const href = target.getAttribute('href');

            // Verificar si es un enlace interno (que empieza con "web/") o relativo
            if (href.startsWith('web/') || href.startsWith('./') || href.startsWith('/')) {
                event.preventDefault(); // Evita la carga completa de la página
                loadContent(href); // Carga el contenido dinámicamente
            } else if (href.startsWith('http://') || href.startsWith('https://')) {
                // Para enlaces externos, no hacemos nada, el navegador los manejará
                return;
            }
        }
    });

    // Detectar cuando el usuario navega hacia atrás/adelante
    window.onpopstate = function(event) {
        if (event.state && event.state.url) {
            loadContent(event.state.url, false); // Cargar sin modificar el historial
        }
    };

    // Cargar contenido inicial basado en el idioma
    document.addEventListener("DOMContentLoaded", function() {
        const userLang = navigator.language || navigator.userLanguage;
        let htmlFile = 'web/ingles.html';

        if (userLang.startsWith('es')) {
            htmlFile = 'web/es.html'; 
        } else if (userLang.startsWith('pt')) {
            htmlFile = 'web/pt.html'; 
        }

        loadContent(htmlFile);
    });
</script>
